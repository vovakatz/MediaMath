
<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <script src="https://code.jquery.com/jquery-2.1.0.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/knockout/3.1.0/knockout-min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="http://www.jsviews.com/download/jsviews.js"></script>
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet" />  

    <script>
        $(document).ready(function ()
        {
            $.ajaxSetup(
		    {
		        error: function (XMLHttpRequest, textStatus, errorThrown) {
		            var response = eval('(' + XMLHttpRequest.responseText + ')');
		            alert(response.ErrorMessage);
		        },
		        cache: false
		    });

            $.ajax(
		    {
		        url: "http://challenge.mediamath.com/api/agencies?api_token=204f3e466debc3c62ad17596199614ccdf222579",
		        success: function (result) 
		        {
		            $.each(result.agencies, function (key, val)
		            {
		                $("#drpAgencies").append('<option id="' + val._id + '">' + val.name + '</option>');
		            });
		        }
		    });

            $("#drpAgencies").change(function (e)
            {
                $("#drpAdvertisers").empty();
                $("#drpAdvertisers").append('<option>Choose an advertiser</option>');
                var selectedAgencyid = $(this).children(':selected').attr('id');
                $.ajax(
		        {
		            url: "http://challenge.mediamath.com/api/advertisers?api_token=204f3e466debc3c62ad17596199614ccdf222579",
		            success: function (result)
		            {
		                $.each(result.advertisers, function (key, val)
		                {
		                    if (val.agency_id == selectedAgencyid)
		                        $("#drpAdvertisers").append('<option id="' + val._id + '">' + val.name + '</option>');
		                });
		            }
		        });
            });

            $("#drpAdvertisers").change(function (e)
            {
                PopulateGrid($(this).children(':selected').attr('id'));
            })            
        })

        function PopulateGrid(advertiserId)
        {
            $.getJSON("http://challenge.mediamath.com/api/campaigns?api_token=204f3e466debc3c62ad17596199614ccdf222579",
                function (result)
                {
                    var tempCampaigns = [];
                    $.each(result.campaigns, function (key, val)
                    {
                        if (val.advertiser_id == advertiserId)
                            tempCampaigns.push(val)
                    });
                    var viewModel =
                    {
                        campaigns: ko.observableArray(tempCampaigns)
                    };
                    ko.applyBindings(viewModel);
                }
            );
        }
    </script>

    </head>
    <body>
        <div style="float:left">
            <div>
                <select id="drpAgencies">
                    <option>Choose an agency...</option>
                </select>
            </div>
            <div>
                <select id="drpAdvertisers">
                    <option>Choose an advertiser...</option>
                </select>
            </div>
        </div>
        <div style="float:right">
            <table>
                <thead>
                    <tr>
                        <td></td>
                        <td>Campaign Name</td>
                        <td>Status</td>
                        <td>Budget</td>
                        <td>Start Date</td>
                        <td>End Date</td>
                    </tr>
                </thead>
                <tbody data-bind="foreach: campaigns" id="tblCampaigns">
                    <tr>
                        <td><input type="checkbox" /></td>
                        <td>{{:name}}</td>
                        <td>{{:status}}</td>
                        <td>{{:budget}}</td>
                        <td>{{:start_date}}</td>
                        <td>{{:end_date}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </body>


    </html>
